# ==============================================
# Mindalike - Cloudflare Workers Configuration
# Deploy to: world.mind-alike.com
# ==============================================

name = "mindalike"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Worker entry point
main = "worker/index.ts"

# Keep workers.dev for testing (separate from routes)
workers_dev = true

# ==============================================
# Static Assets (Next.js build output)
# ==============================================
[assets]
directory = "out"
binding = "ASSETS"
not_found_handling = "single-page-application"

# ==============================================
# Custom Domain Configuration
# ==============================================
[[routes]]
pattern = "world.mind-alike.com"
custom_domain = true

# ==============================================
# D1 Database (Mindalike World Mini App)
# ==============================================
[[d1_databases]]
binding = "DB"
database_name = "mindalike_world_d1"
database_id = "1b8f29b4-167c-450d-9631-66cc63e8a33e"

# ==============================================
# KV Namespace (Daily matches cache)
# ==============================================
[[kv_namespaces]]
binding = "DAILY_MATCHES_CACHE"
id = "6b2d7c13412e4b368c8eba97c15cb787"

# ==============================================
# Durable Objects (Real-time Matching Queue)
# ==============================================
[durable_objects]
bindings = [
  { name = "MATCHING_QUEUE", class_name = "MatchingQueue" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["MatchingQueue"]

# ==============================================
# Environment Variables
# ==============================================
[vars]
ENVIRONMENT = "production"

# ==============================================
# Development Server
# ==============================================
[dev]
port = 8787
local_protocol = "http"
